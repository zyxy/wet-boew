(function(c){var e=10;var a=0.95;function d(v){var h=null,B=null,m=null,s=null,n=null,f=false,u=null;var i=[];v.hooks.processOptions.push(function(D,C){if(C.series.pie.show){C.grid.show=false;if(C.series.pie.label.show=="auto"){if(C.legend.show){C.series.pie.label.show=false}else{C.series.pie.label.show=true}}if(C.series.pie.radius=="auto"){if(C.series.pie.label.show){C.series.pie.radius=3/4}else{C.series.pie.radius=1}}if(C.series.pie.tilt>1){C.series.pie.tilt=1}else{if(C.series.pie.tilt<0){C.series.pie.tilt=0}}}});v.hooks.bindEvents.push(function(E,C){var D=E.getOptions();if(D.series.pie.show){if(D.grid.hoverable){C.unbind("mousemove").mousemove(r)}if(D.grid.clickable){C.unbind("click").click(k)}}});v.hooks.processDatapoints.push(function(G,D,E,F){var C=G.getOptions();if(C.series.pie.show){w(G,D,E,F)}});v.hooks.drawOverlay.push(function(D,E){var C=D.getOptions();if(C.series.pie.show){y(D,E)}});v.hooks.draw.push(function(E,D){var C=E.getOptions();if(C.series.pie.show){o(E,D)}});function x(D){var E="";function C(H,I){if(!I){I=0}for(var G=0;G<H.length;++G){for(var F=0;F<I;F++){E+="\t"}if(typeof H[G]=="object"){E+=""+G+":\n";C(H[G],I+1)}else{E+=""+G+": "+H[G]+"\n"}}}C(D);alert(E)}function w(E,C,D){if(!f){f=true;h=E.getCanvas();B=c(h).parent();b=E.getOptions();E.setData(A(E.getData()))}}function A(H){var G=0,E=0,J=0,C=b.series.pie.combine.color,I=[];for(var D=0;D<H.length;++D){if(typeof(H[D].data)=="number"){H[D].data=[[1,H[D].data]]}else{if(typeof(H[D].data)=="undefined"||typeof(H[D].data[0])=="undefined"){if(typeof(H[D].data)!="undefined"&&typeof(H[D].data.label)!="undefined"){H[D].label=H[D].data.label}H[D].data=[[1,0]]}}}for(var D=0;D<H.length;++D){var F=parseFloat(H[D].data[0][1]);if(F){G+=F}}for(var D=0;D<H.length;++D){H[D].data[0][1]=parseFloat(H[D].data[0][1]);if(!H[D].data[0][1]){H[D].data[0][1]=0}if(H[D].data[0][1]/G<=b.series.pie.combine.threshold){E+=H[D].data[0][1];J++;if(!C){C=H[D].color}}else{I.push({data:[[1,H[D].data[0][1]]],color:H[D].color,label:H[D].label,angle:H[D].data[0][1]*Math.PI*2/G,percent:H[D].data[0][1]/(G/100)})}}if(J>0){I.push({data:[[1,E]],color:C,label:b.series.pie.combine.label,angle:E*Math.PI*2/G,percent:E/(G/100)})}return I}function o(H,K){if(!B){return}var D=H.getPlaceholder().width(),F=H.getPlaceholder().height(),J=B.children().filter(".legend").children().width()||0;u=K;f=false;m=Math.min(D,F/b.series.pie.tilt)/2;n=F/2+b.series.pie.offset.top;s=D/2;if(b.series.pie.offset.left=="auto"){if(b.legend.position.match("w")){s+=J/2}else{s-=J/2}}else{s+=b.series.pie.offset.left}if(s<m){s=m}else{if(s>D-m){s=D-m}}var I=H.getData(),L=0;do{if(L>0){m*=a}L+=1;G();if(b.series.pie.tilt<=0.8){E()}}while(!C()&&L<e);if(L>=e){G();B.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")}if(H.setSeries&&H.insertLegend){H.setSeries(I);H.insertLegend()}function G(){u.clearRect(0,0,D,F);B.children().filter(".pieLabel, .pieLabelBackground").remove()}function E(){var R=b.series.pie.shadow.left;var Q=b.series.pie.shadow.top;var O=10;var P=b.series.pie.shadow.alpha;var M=b.series.pie.radius>1?b.series.pie.radius:m*b.series.pie.radius;if(M>=D/2-R||M*b.series.pie.tilt>=F/2-Q||M<=O){return}u.save();u.translate(R,Q);u.globalAlpha=P;u.fillStyle="#000";u.translate(s,n);u.scale(1,b.series.pie.tilt);for(var N=1;N<=O;N++){u.beginPath();u.arc(0,0,M,0,Math.PI*2,false);u.fill();M-=N}u.restore()}function C(){var P=Math.PI*b.series.pie.startAngle;var M=b.series.pie.radius>1?b.series.pie.radius:m*b.series.pie.radius;u.save();u.translate(s,n);u.scale(1,b.series.pie.tilt);u.save();var R=P;for(var O=0;O<I.length;++O){I[O].startAngle=R;Q(I[O].angle,I[O].color,true)}u.restore();if(b.series.pie.stroke.width>0){u.save();u.lineWidth=b.series.pie.stroke.width;R=P;for(var O=0;O<I.length;++O){Q(I[O].angle,b.series.pie.stroke.color,false)}u.restore()}z(u);u.restore();if(b.series.pie.label.show){return N()}else{return true}function Q(U,S,T){if(U<=0||isNaN(U)){return}if(T){u.fillStyle=S}else{u.strokeStyle=S;u.lineJoin="round"}u.beginPath();if(Math.abs(U-Math.PI*2)>1e-9){u.moveTo(0,0)}u.arc(0,0,M,R,R+U/2,false);u.arc(0,0,M,R+U/2,R+U,false);u.closePath();R+=U;if(T){u.fill()}else{u.stroke()}}function N(){var V=P;var S=b.series.pie.label.radius>1?b.series.pie.label.radius:m*b.series.pie.label.radius;for(var U=0;U<I.length;++U){if(I[U].percent>=b.series.pie.label.threshold*100){if(!T(I[U],V,U)){return false}}V+=I[U].angle}return true;function T(ai,ab,Z){if(ai.data[0][1]==0){return true}var ak=b.legend.labelFormatter,aj,X=b.series.pie.label.formatter;if(ak){aj=ak(ai.label,ai)}else{aj=ai.label}if(X){aj=X(aj,ai)}var ac=((ab+ai.angle)+ab)/2;var ah=s+Math.round(Math.cos(ac)*S);var af=n+Math.round(Math.sin(ac)*S)*b.series.pie.tilt;var Y="<span class='pieLabel' id='pieLabel"+Z+"' style='position:absolute;top:"+af+"px;left:"+ah+"px;'>"+aj+"</span>";B.append(Y);var ag=B.children("#pieLabel"+Z);var W=(af-ag.height()/2);var aa=(ah-ag.width()/2);ag.css("top",W);ag.css("left",aa);if(0-W>0||0-aa>0||F-(W+ag.height())<0||D-(aa+ag.width())<0){return false}if(b.series.pie.label.background.opacity!=0){var ad=b.series.pie.label.background.color;if(ad==null){ad=ai.color}var ae="top:"+W+"px;left:"+aa+"px;";c("<div class='pieLabelBackground' style='position:absolute;width:"+ag.width()+"px;height:"+ag.height()+"px;"+ae+"background-color:"+ad+";'></div>").css("opacity",b.series.pie.label.background.opacity).insertBefore(ag)}return true}}}}function z(C){if(b.series.pie.innerRadius>0){C.save();var D=b.series.pie.innerRadius>1?b.series.pie.innerRadius:m*b.series.pie.innerRadius;C.globalCompositeOperation="destination-out";C.beginPath();C.fillStyle=b.series.pie.stroke.color;C.arc(0,0,D,0,Math.PI*2,false);C.fill();C.closePath();C.restore();C.save();C.beginPath();C.strokeStyle=b.series.pie.stroke.color;C.arc(0,0,D,0,Math.PI*2,false);C.stroke();C.closePath();C.restore()}}function p(F,G){for(var H=false,E=-1,C=F.length,D=C-1;++E<C;D=E){((F[E][1]<=G[1]&&G[1]<F[D][1])||(F[D][1]<=G[1]&&G[1]<F[E][1]))&&(G[0]<(F[D][0]-F[E][0])*(G[1]-F[E][1])/(F[D][1]-F[E][1])+F[E][0])&&(H=!H)}return H}function q(K,J){var E=v.getData(),H=v.getOptions(),I=H.series.pie.radius>1?H.series.pie.radius:m*H.series.pie.radius,N,L;for(var U=0;U<E.length;++U){var Q=E[U];if(Q.pie.show){u.save();u.beginPath();u.moveTo(0,0);u.arc(0,0,I,Q.startAngle,Q.startAngle+Q.angle/2,false);u.arc(0,0,I,Q.startAngle+Q.angle/2,Q.startAngle+Q.angle,false);u.closePath();N=K-s;L=J-n;if(u.isPointInPath){if(u.isPointInPath(K-s,J-n)){u.restore();return{datapoint:[Q.percent,Q.data],dataIndex:0,series:Q,seriesIndex:U}}}else{var T=I*Math.cos(Q.startAngle),S=I*Math.sin(Q.startAngle),F=I*Math.cos(Q.startAngle+Q.angle/4),C=I*Math.sin(Q.startAngle+Q.angle/4),O=I*Math.cos(Q.startAngle+Q.angle/2),M=I*Math.sin(Q.startAngle+Q.angle/2),W=I*Math.cos(Q.startAngle+Q.angle/1.5),V=I*Math.sin(Q.startAngle+Q.angle/1.5),G=I*Math.cos(Q.startAngle+Q.angle),D=I*Math.sin(Q.startAngle+Q.angle),R=[[0,0],[T,S],[F,C],[O,M],[W,V],[G,D]],P=[N,L];if(p(R,P)){u.restore();return{datapoint:[Q.percent,Q.data],dataIndex:0,series:Q,seriesIndex:U}}}u.restore()}}return null}function r(C){l("plothover",C)}function k(C){l("plotclick",C)}function l(C,I){var D=v.offset();var G=parseInt(I.pageX-D.left);var E=parseInt(I.pageY-D.top);var K=q(G,E);if(b.grid.autoHighlight){for(var F=0;F<i.length;++F){var H=i[F];if(H.auto==C&&!(K&&H.series==K.series)){g(H.series)}}}if(K){j(K.series,C)}var J={pageX:I.pageX,pageY:I.pageY};B.trigger(C,[J,K])}function j(D,E){var C=t(D);if(C==-1){i.push({series:D,auto:E});v.triggerRedrawOverlay()}else{if(!E){i[C].auto=false}}}function g(D){if(D==null){i=[];v.triggerRedrawOverlay()}var C=t(D);if(C!=-1){i.splice(C,1);v.triggerRedrawOverlay()}}function t(E){for(var C=0;C<i.length;++C){var D=i[C];if(D.series==E){return C}}return -1}function y(G,H){var E=G.getOptions();var C=E.series.pie.radius>1?E.series.pie.radius:m*E.series.pie.radius;H.save();H.translate(s,n);H.scale(1,E.series.pie.tilt);for(var F=0;F<i.length;++F){D(i[F].series)}z(H);H.restore();function D(I){if(I.angle<=0||isNaN(I.angle)){return}H.fillStyle="rgba(255, 255, 255, "+E.series.pie.highlight.opacity+")";H.beginPath();if(Math.abs(I.angle-Math.PI*2)>1e-9){H.moveTo(0,0)}H.arc(0,0,C,I.startAngle,I.startAngle+I.angle/2,false);H.arc(0,0,C,I.startAngle+I.angle/2,I.startAngle+I.angle,false);H.closePath();H.fill()}}}var b={series:{pie:{show:false,radius:"auto",innerRadius:0,startAngle:3/2,tilt:1,shadow:{left:5,top:15,alpha:0.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(f,g){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+g.color+";'>"+f+"<br/>"+Math.round(g.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:0.5}}}};c.plot.plugins.push({init:d,options:b,name:"pie",version:"1.1"})})(jQuery);